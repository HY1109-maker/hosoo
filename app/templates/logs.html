{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">操作ログ</h1>
    
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>日時</th>
                <th>ユーザー</th>
                <th>店舗</th>
                <th>商品名</th>
                <th>操作内容</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log.timestamp.strftime('%Y/%m/%d %H:%M') }}</td>
                <td>{{ log.user.username }}</td>
                <td>{{ log.inventory.store.name }}</td>
                <td>{{ log.inventory.product.name }}</td>
                {% if log.quantity_before != log.quantity_after and log.threshold_before != log.threshold_after %}
                    <td>在庫数 : <strong>{{ log.quantity_before }}</strong> → <strong>{{ log.quantity_after }}</strong> </br>
                        閾値 : <strong>{{ log.threshold_before }}</strong> → <strong>{{ log.threshold_after }}</strong></td>
                {% elif log.quantity_before != log.quantity_after and log.threshold_before == log.threshold_after %}
                    <td>在庫数 : <strong>{{ log.quantity_before }}</strong> → <strong>{{ log.quantity_after }}</strong></td>
                {% elif log.quantity_before == log.quantity_after and log.threshold_before != log.threshold_after %}
                    <td>閾値 : <strong>{{ log.threshold_before }}</strong> → <strong>{{ log.threshold_after }}</strong></td>
                {% endif %}
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-center">ログはまだありません。</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {# ページネーション (在庫一覧と同じ) #}
    {% if pagination %}
    <nav>
        <ul class="pagination justify-content-center">
            <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('main.view_logs', page=pagination.prev_num) }}">前へ</a>
            </li>
            {% for p in pagination.iter_pages() %}
                {% if p %}
                    <li class="page-item {% if p == pagination.page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('main.view_logs', page=p) }}">{{ p }}</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">…</span></li>
                {% endif %}
            {% endfor %}
            <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('main.view_logs', page=pagination.next_num) }}">次へ</a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}